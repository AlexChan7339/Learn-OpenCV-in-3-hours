# 4-基本函数

## 4.1-转化颜色空间和模糊图像

```python
import cv2

# 读取图像
img = cv2.imread("Resources/lena.png")

# 转化为灰度图像
imgGray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# 模糊图像
imgBlur = cv2.GaussBlur(imgGray, (7, 7), 0)

# 展示图像
cv2.imshow("Gray Image", imgGray)
cv2.imshow("Blur Image", imgBlur)
cv2.waitKey(0)
```

- `cvtColor(img, cv2.COLOR_BGR2GRAY)`:图像转换为不同的色彩空间
  - `img`：想要转换的图像变量
  - `cv2.COLOR_BGR2GRAY`：希望将图像转换到哪种颜色空间（这里是将三通道BGR转化为灰度图像）
    - 通常我们会使用RGB通道表示正常彩色图像，而在OpenCV中，图像的通道顺序是 BGR
- `cv2.GaussBlur(imgGray, (7, 7), 0)`:高斯模糊函数
  - `imgGray`：需要模糊的图像变量（可以是彩色图像，也可以是灰度图像）
  - `(7, 7)`：kernel size，值必须为奇数，这边（7， 7）将增加相当多的模糊
  - sigma=0:滤波平滑系数

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238756.png" alt="image-20251108211147638" style="zoom:25%;" />

## 4.2-边缘检测

### 4.2.1- Canny 边缘检测器

边缘检测也就是发现图像中的边缘

```python
import cv2

# 读取图像
img = cv2.imread("Resources/lena.png")

# 边缘检测
imgCanny = cv2.Canny(img, 100, 100)

# 显示图像
cv2.imshow("Canny Image", imgCanny)
cv2.waitKey(0)
```

`cv2.Canny(img, 100, 100)`

- `img`：边缘提取的图像变量名称
- `100, 100`：
  - （低阈值，高阈值）
  - 边缘检测中用低阈值判断弱边缘的阈值。低于此值的像素点会被视为非边缘，直接丢弃；
  - 高阈值用于判断强边缘的阈值。高于此值的像素点会被直接判定为边缘（强边缘）；
  - 介于两者之间的像素，若与强边缘相连，则被标记为**弱边缘**（保留），否则视为非边缘。
  - 低阈值和高阈值的比值一般建议在 2:1 到 3:1 之间，以平衡边缘的灵敏度和抗噪声能力

![image-20251108211858003](https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238902.png)

中间的图中我们得到了很多边缘，如果我们想减少它，需要改变阈值，比如将高阈值设置为 200，将低阈值设置为 150

```python
import cv2

# 读取图像
img = cv2.imread("Resources/lena.png")

# 边缘检测
imgCanny = cv2.Canny(img, 150, 200)

# 显示图像
cv2.imshow("Canny Image", imgCanny)
cv2.waitKey(0)
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238868.png" alt="image-20251108212104628" style="zoom:50%;" />

## 4.3-膨胀

有时我们在检测边缘，会因为存在间隙或者连接不当，没有将其识别为正确的边界。需要增加边缘厚度提高识别精度，方法就是膨胀

```python
import cv2
import numpy as np#用于计算dilation的kernel matrix
# 读取图像
img = cv2.imread("Resources/lena.png")
kernel = np.ones((5, 5), np.uint8)	# 八位的无符号整数
# 边缘检测
imgCanny = cv2.Canny(img, 150, 200)
imgDialation = cv2.dilate(imgCanny, kernel, iterations=1)

# 显示图像
cv2.imshow("Canny Image", imgCanny)
cv2.imshow("Dilation Image", imgDialation)
cv2.waitKey(0)
```

`cv2.dilate(imgCanny, kernel, iterations=1)`:

- `imgCanny`:进行膨胀操作的边缘图像
- `kernel`：内核大小，即用矩阵表示，包含所有相同的值 
- `iterations=1`:希望内核能够移动，这意味着我们实际需要多少厚度

![image-20251108220042796](https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238812.png)

增加Dialation的迭代次数，我们来看看变化

```python
import cv2
import numpy as np#用于计算dilation的kernel matrix
# 读取图像
img = cv2.imread("Resources/lena.png")
kernel = np.ones((5, 5), np.uint8)	# 八位的无符号整数
# 边缘检测
imgCanny = cv2.Canny(img, 150, 200)
imgDialation = cv2.dilate(imgCanny, kernel, iterations=5)

# 显示图像
cv2.imshow("Canny Image", imgCanny)
cv2.imshow("Dilation Image", imgDialation)
cv2.waitKey(0)
```

![image-20251108220206807](https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238882.png)

## 4.3-腐蚀

> 侵蚀是膨胀的逆操作，将边缘变得更薄

```python
import cv2
import numpy as np#用于计算dilation的kernel matrix
# 读取图像
img = cv2.imread("Resources/lena.png")
kernel = np.ones((5, 5), np.uint8)	# 八位的无符号整数
# 边缘检测
imgCanny = cv2.Canny(img, 150, 200)
imgDialation = cv2.dilate(imgCanny, kernel, iterations=1)
imgEroded = cv2.erode(imgDialation, kernel, iterations=1)

# 显示图像
cv2.imshow("Canny Image", imgCanny)
cv2.imshow("Dilation Image", imgDialation)
cv2.imshow("Erosion Image", imgEroded)
cv2.waitKey(0)
```

`cv2.erode(imgDialation, kernel, iterations=1)`:

- `imgDialation`:进行腐蚀操作的边缘图像
- `kernel`：内核大小，即用矩阵表示，包含所有相同的值 
- `iterations=1`:希望内核能够移动，这意味着我们实际需要多少厚度

![image-20251108220644315](https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238834.png)

## 4.4-图片大小调整和裁剪

> - 在数学中，当绘制图形时。x 轴的正方向朝东，Y 轴的正方向指向北方。
>
>   <img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238657.png" alt="image-20251108220910811" style="zoom:25%;" />
>
> - 在 OpenCV 中，x 轴是相同的，但正的 y 轴指向南方。
>
>   <img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238755.png" alt="image-20251108220928871" style="zoom:25%;" />
>
>   - 以下图为例（这张图片是 640 乘以 480）
>
>     <img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238194.png" alt="image-20251108221107333" style="zoom:25%;" />
>
>     - 图像的起点位于左上角的（0，0）
>     - 最大宽度和高度位于右下角（640， 480）

### 4.4.1-图片大小调整

调整图像大小前，需要知道我们图片的当前大小

```python
import cv2
import numpy as np

img = cv2.imread("Resourcrs/lambo.png")
print(img.shape)# 展示图片的当前大小
# （462， 623， 3）：高度为462，宽度为623，频道数为3

imgResize = cv2.resize(img, (300, 200))
print(imgResize.shape)
# （200， 300， 3）
cv2.imshow("Image", img)
cv2.imshow("Image Resize", imgResize)

cv2.waitKey(0)
```

`cv2.resize(img, (300, 200))`:

- `img`:进行调整图像大小的图像
- `300`：调整后的宽度值
- `200`:调整后的高度值

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238126.png" alt="image-20251108221913651" style="zoom:50%;" />

实际上也可以增加像素的数量,但不会提高质量。

```python
import cv2
import numpy as np

img = cv2.imread("Resourcrs/lambo.png")
print(img.shape)# 展示图片的当前大小
# （462， 623， 3）：高度为462，宽度为623，频道数为3

imgResize = cv2.resize(img, (1000, 500))
print(imgResize.shape)
# （500， 1000， 3）
cv2.imshow("Image", img)
cv2.imshow("Image Resize", imgResize)

cv2.waitKey(0)
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238353.png" alt="image-20251108222143877" style="zoom: 33%;" />

### 4.4.2-图片剪裁

图像本身只是一个矩阵，或者一个像素数组，图像剪裁主要是对矩阵进行处理

```python
import cv2
import numpy as np

img = cv2.imread("Resourcrs/lambo.png")
print(img.shape)# 展示图片的当前大小
# （462， 623， 3）：高度为462，宽度为623，频道数为3

imgResize = cv2.resize(img, (1000, 500))
print(imgResize.shape)
# （500， 1000， 3）
imgCropped = img[0:200, 200:500]# 维度上面先y轴再x轴(先高度再宽度)
cv2.imshow("Image", img)
cv2.imshow("Image Resize", imgResize)
cv2.imshow("Image Cropped", imgCropped)

cv2.waitKey(0)
```

`img[0:200, 200:500]`:

- `img`:进行调整图像大小的图像
- `0:200`：矩阵高度方向切片（保留从左到右0~200列的像素）
- ` 200:500`:矩阵宽度方向切片（保留从上到下200~500行的像素）

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238490.png" alt="image-20251108223022185" style="zoom: 25%;" />

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238597.png" alt="image-20251108223151819" style="zoom:25%;" />

---

## 4.5-形状和文本

我们将学习如何画线、矩形、圆圈，以及学习如何在图像上放置文本

```python
import cv2
import numpy as np

img = np.zeros((512, 512))# 零代表黑色
print(img.shape)
# (512, 512)
cv2.imshow("image", img)
cv2.waitKey(0)
# 展示一个全黑色图像
```

```python
# 添加颜色功能
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
print(img)
img[:] =  255, 0, 0 # BGR(给全部图像上蓝色)
cv2.imshow("image", img)
cv2.waitKey(0)
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238584.png" alt="image-20251108233732120" style="zoom:25%;" />

```python
# 对图像矩阵切片添加颜色
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
print(img)
img[200:300, 100:300] =  255, 0, 0 # BGR(给切片图像上蓝色)
cv2.imshow("image", img)
cv2.waitKey(0)
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238828.png" alt="image-20251108233854028" style="zoom:25%;" />

### 4.5.1-绘制线

```python
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道

cv2.line(img, (0, 0), (300, 300), (0, 255, 0), 3)
cv2.imshow("image", img)
cv2.waitKey(0)
```

`cv2.line(img, (0, 0), (300, 300))`:

- `img`:进行绘制直线的图像对象
- `(0, 0)`：直线起点在图像上的位置
- ` (300, 300)`:直线终点在图像上的位置
- `(0, 255, 0)`：直线的颜色，为绿色
- 3：线的宽度

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238069.png" alt="image-20251108234257636" style="zoom:25%;" />

```python
# 绿线从（0，0）点连到右下角（变为对角线）
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道

cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
# img.shape[1]:height
# img.shape[0]：width
cv2.imshow("image", img)
cv2.waitKey(0)
```

### 4.5.2-绘制矩形

```python
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
cv2.rectangle(img, (0, 0), (250, 350), (0, 0, 255), 3)
cv2.imshow("image", img)
cv2.waitKey(0)
```

`cv2.rectangle(img, (0, 0), (300, 300))`:

- `img`:进行绘制直线的图像对象
- `(0, 0)`：矩形左上角在图像上的位置
- ` (250, 350)`:矩形右下角在图像上的位置
- `(0, 0, 255)`：直线的颜色，为红色
- 3：线的宽度

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238241.png" alt="image-20251108234754101" style="zoom:25%;" />

```python
# 将矩形区域进行填充
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
cv2.rectangle(img, (0, 0), (250, 350), (0, 0, 255), cv2.FILLED)# 将矩形区域进行填充
cv2.imshow("image", img)
cv2.waitKey(0)
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238281.png" alt="image-20251108234935851" style="zoom:25%;" />

### 4.5.3-绘制圆形

```python
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
cv2.rectangle(img, (0, 0), (250, 350), (0, 0, 255), 2)# 将矩形区域进行填充
cv2.circle(img, (400, 50), 30, (255, 255, 0), 5)

```

`cv2.circle(img, (400, 50), 30, (255, 255, 0), 5)`:

- `img`:进行绘制圆形的图像对象
- `(400, 500)`：圆心位置
- ` 30`:半径
- `(255, 255, 0)`：圆形的颜色，为蓝色的一种，浅蓝色
- 5：圆轮廓的宽度

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238407.png" alt="image-20251109112806817" style="zoom:50%;" />

### 4.5.4-在图片上放置文字

```python
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
cv2.rectangle(img, (0, 0), (250, 350), (0, 0, 255), 2)# 将矩形区域进行填充
cv2.circle(img, (400, 50), 30, (255, 255, 0), 5)
cv2.putText(img, " OPENCV", (300, 100), cv2.FONT_HERSHEY_COMPLEX, 1, (0, 150, 0), 1)
```

`cv2.putText(img, " OPENCV", (300, 100), cv2.FONT_HERSHEY_COMPLEX, 1, (0, 150, 0), 1)`:

- `img`:进行放置文字的图像对象
- `" OPENCV"`：文字内容
- ` (300, 100)`:文本绘制的起始坐标
- `cv2.FONT_HERSHEY_COMPLEX`：OpenCV 内置的一种复杂字体（带衬线，较清晰），其他常用字体包括：`cv2.FONT_HERSHEY_SIMPLEX`（简单无衬线字体）、`cv2.FONT_HERSHEY_PLAIN`（小型无衬线字体）、`cv2.FONT_HERSHEY_BOLD`（粗体）等。
- 1：字体缩放比例 `fontScale`，控制文字大小。取值为 1 表示默认大小，值越大文字越大（如 2 表示放大 2 倍）。
- `(0, 150, 0)`：圆形的颜色，为绿色的一种
- 1：文字线条粗细 `thickness`，控制文字边缘的粗细

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238848.png" alt="image-20251109113627450" style="zoom:33%;" />

```python
import cv2
import numpy as np

img = np.zeros((512, 512, 3), np.uint8)# 变为3通道
cv2.line(img, (0, 0), (img.shape[1], img.shape[0]), (0, 255, 0), 3)
cv2.rectangle(img, (0, 0), (250, 350), (0, 0, 255), 2)# 将矩形区域进行填充
cv2.circle(img, (400, 50), 30, (255, 255, 0), 5)
cv2.putText(img, " OPENCV", (300, 200), cv2.FONT_HERSHEY_COMPLEX, 0.5, (0, 150, 0), 1)
# 会发现字体变的很小
```

<img src="https://typora3.oss-cn-shanghai.aliyuncs.com/202511132238957.png" alt="image-20251109113922368" style="zoom:33%;" />